<%@ page contentType="text/html;charset=utf-8" pageEncoding="UTF-8" %>

<h1 id="titre">Mon historique</h1>

<div class="ui equal width two column grid">
	<div class="column">
		<div style="overflow-y: auto; max-height: 70vh;">
		<table class="ui violet table">
			<thead>
				<tr>
				    <th>Date</th>
				    <th>Médium</th>
                                    <th>Durée</th>
			  	</tr>
			</thead>
			  <tbody id="history_container">
			    
			  </tbody>
		</table>
	</div>
	</div>
</div>	


<script>
            $('document').ready(() => {      
                    //Retrive user informations
                    $.ajax({
                        url: '../ActionServlet',
                        type: 'GET',
                        data: 'todo=session',
                        success: (resp) => {                           
                            $('#titre').replaceWith('<h1> Historique de '+resp.data.prenom+" "+resp.data.nom+' : </h1>');
                        },
                        error: function(xhr, resp, text) {
                            $('#server_error').transition('jiggle');
                        }
                    });
                    //Retrieve user history                    
                    $.ajax({
                        url: 'ActionServlet',
                        type: 'GET',
                        data: 'todo=historiqueClient',
                        success: (resp) => {
                            if(resp.success) {
                                
                                console.log(resp.data);
                                
	                	resp.data.forEach((m) => {
                                        var debut = new Date(m.debut);
                                        var fin = new Date(m.fin);
                                        
                                        var diff = Math.abs(fin - debut);
                                        var minutes = Math.floor((diff/1000)/60);
                                    
	                		$('#history_container').append(`
	                		<tr class="print_bio">
							    <td>`+debut.getDate()+'/'+(debut.getMonth()+1)+'/'+debut.getFullYear()+`</td>
							    <td>`+m.medium.nom+`</td>
                                                            <td>`+minutes+`</td>
						
			    			</tr>`);
	                	});
	                }
	                else {
	                    $('#data_error').transition('jiggle');
	                }
                        },
                        error: function(xhr, resp, text) {
                            $('#server_error').transition('jiggle');
                        }
                    });
                                       
                    
            });
        </script>