<!DOCTYPE html>
<html>
    <head>
        <title>Voyance</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.css">
        <link rel="stylesheet" type ="text/css" href="../my_styles.css" />
        <script
          src="https://code.jquery.com/jquery-3.3.1.min.js"
          integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
          crossorigin="anonymous">
        </script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.3.1/semantic.min.js"></script>
    </head>
    <body style="background: linear-gradient(to right, #fafafa, #fefefe)">
		<div class="ui padded stackable two column grid">
			<div class="six wide column">
				<h2>Profil Client</h2>
				<div class="ui equal width two column grid">
					<div class="column">Nom</div>
					<div id="lastName" class="column right aligned"></div>

					<div class="column">Prénom</div>
					<div id="firstName" class="column  right aligned"></div>

					<div class="column">Signe du Zodiaque</div>
					<div id="zodiac" class="column  right aligned"></div>

					<div class="column">Signe Astrologique Chinois</div>
					<div id="astro" class="column  right aligned"></div>

					<div class="column">Couleur Porte-Bonheur</div>
					<div id="color" class="column  right aligned"></div>

					<div class="column">Animal Totem</div>
					<div id="animal" class="column  right aligned"></div>
				</div>  
			</div>
			<div class="ten wide column">
				<h2>Historique Client</h2>
				<div class="ui grid">
					<div class="eight wide column">
						bb
					</div>
					<div class="eight wide column">
						<textarea id="comment" placeholder="Commentaire sur la voyance sélectionnée..." style="text-align: justify;max-height: 95%; height:95%; width:90%;"></textarea>
					</div>	
				</div>
			</div>
			<div class="column">
				<h2>Générer une prédiction</h2>
				<div class="ui stackable grid">
					<div class="five wide column">
						<form id="prediction" method="POST" action="../ActionServlet" class="ui form">
							<input class="ui button" id="submit" type="submit" name="submit" value="Générer la prédiction">
					        <div class="field">
					            <label for="love">Note amour</label>
					            <input type="number" id="love" name="love" min="1" max="4">
					        </div>
					        <div class="field">
					            <label for="work">Note travail</label>
					            <input type="number" id="work" name="work" min="1" max="4">
					        </div>
					        <div class="field">
					            <label for="health">Note santé</label>
					            <input type="number" id="health" name="health" min="1" max="4">
					        </div>		     
						    <input type="hidden" name="todo" value="prediction" />
						</form> 
					</div>
					<div class="eleven wide column">
						<div id="prediction_container" class="ui padded segment" style="overflow-y: auto; max-height: 95%; height:95%">
					
						</div>
					</div>
				</div>
			</div>
			<div class="column">
				<h2>Gérer la voyance (Médium demandé : <span id="medium_name"></span>)</h2>
				<div class="ui stackable grid">
					<div class="five wide column">
						<div class="ui basic segment ">
							<button id="start_voyance" style="width:100%" class="ui button">Commencer la voyance</button>
						</div>
						<div class="ui basic segment">
							<button disabled id="end_voyance" style="width:100%" class="ui button">Terminer la voyance</button>
						</div>
						<div class="ui basic segment">
							<button disabled id="validation" style="width:100%" class="ui button">Valider</button>
						</div>
					</div>
					<div class="eleven wide column">
						<textarea id="comment" placeholder="Commentaire sur la voyance en cours..." style="text-align: justify;max-height: 95%; height:95%; width:90%;"></textarea>
					</div>	
				</div>		
			</div>
			<div class="my_alert">
			    <div id="server_error" class="mini error ui message">
			        <i class="close icon" onclick=" $(this).closest('.message').transition('zoom');"></i>
			        <div class="header">
			            Erreur interne du serveur
			        </div>
			        <p>Veuillez réessayer ultérieurement.</p>
			    </div>
			    <div id="voyanceGetClient_error" class="mini error ui message">
			        <i class="close icon" onclick=" $(this).closest('.error.message').transition('zoom');"></i>
			        <div class="header">
			            Les informations du client <br /> n'ont pas pu être récupérées
			        </div>
			    </div>
			    <div id="voyanceGetClientHistory_error" class="mini error ui message">
			        <i class="close icon" onclick=" $(this).closest('.error.message').transition('zoom');"></i>
			        <div class="header">
			            L'historique du client <br /> n'a pas pu être récupéré
			        </div>
			    </div>
			    <div id="prediction_error" class="mini error ui message">
			        <i class="close icon" onclick=" $(this).closest('.error.message').transition('zoom');"></i>
			        <div class="header">
			            La prédiction n'a pu être réalisée
			        </div>
			        <p>Veuillez réessayer ultérieurement</p>
			    </div>
			</div>
		</div>
		<script type="text/javascript">
			$('document').ready(() => {
			    console.log('document is ready');
		        $.ajax({
		            url: '../ActionServlet',
		            type: 'POST',
		            data: 'todo=voyanceGetClient',
		            success: (resp) => {
		                if(resp.success) {
	                		console.log('voyanceGetClient success');
	                		$('#lastName').text(resp.data.nom);
	                		$('#firstName').text(resp.data.prenom);
	                		$('#zodiac').text(resp.data.signeZodiaque);
	                		$('#astro').text(resp.data.signeAstroChinois);
	                		$('#color').text(resp.data.couleurPorteBonheur);
	                		$('#animal').text(resp.data.animalTotem); 
		                }
		                else {
		                    $('#voyanceGetClient_error').transition('jiggle');
		                }
		            },
		            error: function(xhr, resp, text) {
		                $('#server_error').transition('jiggle');
		            }
		        });

    	        $.ajax({
    	            url: '../ActionServlet',
    	            type: 'POST',
    	            data: 'todo=voyanceGetClientHistory',
    	            success: (resp) => {
    	                if(resp.success) {
                    		console.log('voyanceGetClientHistory success');
                    		
    	                }
    	                else {
    	                    $('#voyanceGetClientHistory_error').transition('jiggle');
    	                }
    	            },
    	            error: function(xhr, resp, text) {
    	                $('#server_error').transition('jiggle');
    	            }
    	        });	

    	        $('#prediction').on('submit', function(event) {
    	            event.preventDefault();
    	            console.log('prediction form submitted');   
    	            console.log($(this).serialize());  
    	            $('.my_alert').children().hide();              
    	            $.ajax({
    	                url: $(this).attr('action'),
    	                type: $(this).attr('method'),
    	                dataType: 'json',
    	                data: $(this).serialize(),
    	                success: (resp) => {
    	                    if(resp.success) {
    	                    	console.log(resp.data);
    	                    	resp.data.forEach((paragraph)=> {
    	                    		$('#prediction_container').append('<p style="text-align: justify;">'+paragraph+'</p>'); 
    	                    	});
    	                    }
    	                    else {
    	                    	console.log('prediction_error');
    	                        $('#prediction_error').transition('jiggle');
    	                    }
    	                },
    	                error: function(xhr, resp, text) {
    	                    console.log('server_error');
    	                    $('#server_error').transition('jiggle');
    	                }
    	            });
    	        });        	       	
			});
		</script>	
	</body>
</html>				
